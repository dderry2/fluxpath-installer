# ============================================
# File: mmu/mmu_toolchange.cfg
# Location: ~/printer_data/config/mmu/
#
# Purpose:
#   Lane-aware toolchange + T0â€“T3 for slicer.
# ============================================

[gcode_macro MMU_TOOL_CHANGE]
description: Unload current lane, switch lane, load new lane
gcode:
  {% set lane = params.LANE|int %}
  {% set v = printer["gcode_macro MMU_VARS"] %}

  {% if lane < 1 or lane > v.mmu_lanes %}
    MMU_ERROR MSG="Requested lane {{ lane }} but mmu_lanes={{ v.mmu_lanes }}"
  {% endif %}

  RESPOND PREFIX=MMU MSG="TOOL_CHANGE: from lane {{ v.active_lane }} to lane {{ lane }}"

  MMU_UNLOAD
  MMU_SET_LANE LANE={lane}
  MMU_LOAD

  RESPOND PREFIX=MMU MSG="TOOL_CHANGE complete, active lane {{ lane }}"

[gcode_macro T0]
gcode:
  MMU_TOOL_CHANGE LANE=1

[gcode_macro T1]
gcode:
  MMU_TOOL_CHANGE LANE=2

[gcode_macro T2]
gcode:
  MMU_TOOL_CHANGE LANE=3

[gcode_macro T3]
gcode:
  MMU_TOOL_CHANGE LANE=4
