# ============================================
# File: mmu/mmu_diagnostics.cfg
# Location: ~/printer_data/config/mmu/
#
# Purpose:
#   Diagnostics for sensors + lanes.
# ============================================

[gcode_macro MMU_DIAG_SENSOR_TEST]
gcode:
  {% set pregate = printer["filament_switch_sensor pregate"] %}
  {% set fs = printer["filament_switch_sensor filament_sensor"] %}
  RESPOND PREFIX=MMU MSG="Pregate: {{ 'TRIGGERED' if pregate.filament_detected else 'open' }}"
  RESPOND PREFIX=MMU MSG="Filament Sensor: {{ 'TRIGGERED' if fs.filament_detected else 'open' }}"

[gcode_macro MMU_DIAG_EXPECT_SENSOR]
gcode:
  RESPOND PREFIX=MMU MSG="DIAG: Moving to filament sensor..."
  MMU_MOVE_TO_CUTTER_FROM_PARK
  MMU_MOVE_TO_FILAMENT_SENSOR_EXPECT
  RESPOND PREFIX=MMU MSG="DIAG: Sensor triggered as expected."

[gcode_macro MMU_DIAG_LANE]
description: Test load/unload for a specific lane
gcode:
  {% set lane = params.LANE|int %}
  MMU_SET_LANE LANE={lane}
  RESPOND PREFIX=MMU MSG="DIAG: Testing lane {{ lane }} load/unload"
  MMU_LOAD
  MMU_UNLOAD
  RESPOND PREFIX=MMU MSG="DIAG: Lane {{ lane }} test complete"
